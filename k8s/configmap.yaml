apiVersion: v1
kind: ConfigMap
metadata:
  name: microdns-leaf-config
  namespace: microdns
  labels:
    app.kubernetes.io/name: microdns
    app.kubernetes.io/component: leaf
data:
  microdns.toml: |
    [instance]
    id = "leaf-default"
    mode = "leaf"

    [coordinator]
    endpoint = "grpc://microdns-coordinator.microdns.svc:50051"
    heartbeat_interval_secs = 10
    report_interval_secs = 30

    [dns.auth]
    enabled = true
    listen = "0.0.0.0:53"

    [dns.recursor]
    enabled = true
    listen = "0.0.0.0:5353"
    cache_size = 10000

    [dns.loadbalancer]
    enabled = true
    check_interval_secs = 10
    default_probe = "ping"

    [api.rest]
    enabled = true
    listen = "0.0.0.0:8080"

    [api.grpc]
    enabled = true
    listen = "0.0.0.0:50051"

    [database]
    path = "/data/microdns.redb"

    [logging]
    level = "info"
    format = "json"

    [messaging]
    backend = "kafka"
    brokers = ["redpanda.microdns.svc:9092"]
    topic_prefix = "microdns"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: microdns-coordinator-config
  namespace: microdns
  labels:
    app.kubernetes.io/name: microdns
    app.kubernetes.io/component: coordinator
data:
  microdns.toml: |
    [instance]
    id = "coordinator"
    mode = "coordinator"

    [dns.auth]
    enabled = true
    listen = "0.0.0.0:53"

    [dns.recursor]
    enabled = true
    listen = "0.0.0.0:5353"
    cache_size = 50000

    [api.rest]
    enabled = true
    listen = "0.0.0.0:8080"

    [api.grpc]
    enabled = true
    listen = "0.0.0.0:50051"

    [database]
    path = "/data/microdns.redb"

    [logging]
    level = "info"
    format = "json"

    [messaging]
    backend = "kafka"
    brokers = ["redpanda.microdns.svc:9092"]
    topic_prefix = "microdns"
